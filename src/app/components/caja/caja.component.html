<div class="modal-bg"
     [ngClass]="{'show': mostrarCaja}">
    <div class="modal-box">
        <div class="modal-header">
            <span>Caja</span>
            <a href="#"
               (click)="cerrarCaja($event)">
                <mat-icon>close</mat-icon>
            </a>
        </div>
        <div class="modal-body">
            <mat-tab-group [selectedIndex]="cajaSelectedTab"
                           (selectedIndexChange)="cajaSelectedTab = $event"
                           #cajaTabs>
                <mat-tab label="HISTÓRICO DE VENTAS">
                    <div class="historico-header">
                        <mat-form-field class="mat-form-field-no-bottom historico-header-options">
                            <mat-select [(ngModel)]="historicoModo">
                                <mat-option value="fecha">
                                    Fecha
                                </mat-option>
                                <mat-option value="rango">
                                    Rango
                                </mat-option>
                            </mat-select>
                        </mat-form-field>
                        <div class="historico-header-fecha"
                             [ngClass]="{'show': historicoModo === 'fecha'}">
                            <button mat-icon-button
                                    (click)="previousFecha()">
                                <mat-icon>chevron_left</mat-icon>
                            </button>
                            <mat-form-field class="mat-form-field-no-bottom">
                                <mat-label>Elige fecha</mat-label>
                                <input matInput
                                       [matDatepicker]="fechaPicker"
                                       [(ngModel)]="fecha"
                                       (ngModelChange)="changeFecha()">
                                <mat-datepicker-toggle matSuffix
                                                       [for]="fechaPicker"></mat-datepicker-toggle>
                                <mat-datepicker #fechaPicker></mat-datepicker>
                            </mat-form-field>
                            <button mat-icon-button
                                    (click)="nextFecha()">
                                <mat-icon>chevron_right</mat-icon>
                            </button>
                        </div>
                        <div class="historico-header-rango"
                             [ngClass]="{'show': historicoModo === 'rango'}">
                            <mat-form-field class="mat-form-field-no-bottom">
                                <mat-label>Fecha desde</mat-label>
                                <input matInput
                                       [matDatepicker]="rangoDesdePicker"
                                       [(ngModel)]="rangoDesde">
                                <mat-datepicker-toggle matSuffix
                                                       [for]="rangoDesdePicker"></mat-datepicker-toggle>
                                <mat-datepicker #rangoDesdePicker></mat-datepicker>
                            </mat-form-field>
                            <mat-form-field class="mat-form-field-no-bottom">
                                <mat-label>Fecha hasta</mat-label>
                                <input matInput
                                       [matDatepicker]="rangoHastaPicker"
                                       [(ngModel)]="rangoHasta">
                                <mat-datepicker-toggle matSuffix
                                                       [for]="rangoHastaPicker"></mat-datepicker-toggle>
                                <mat-datepicker #rangoHastaPicker></mat-datepicker>
                            </mat-form-field>
                        </div>
                    </div>
                    <div class="historico-body">
                        <div class="historico-table">
                            <table mat-table
                                   [dataSource]="historicoVentasDataSource"
                                   matSort
                                   class="mat-elevation-z2 ">

                                <!-- Fecha -->
                                <ng-container matColumnDef="fecha">
                                    <th mat-header-cell
                                        *matHeaderCellDef
                                        mat-sort-header
                                        sortActionDescription="Ordenar por fecha">
                                        Fecha
                                    </th>
                                    <td mat-cell
                                        *matCellDef="let element"> {{element.fecha}} </td>
                                </ng-container>

                                <!-- Importe -->
                                <ng-container matColumnDef="total">
                                    <th mat-header-cell
                                        *matHeaderCellDef
                                        mat-sort-header
                                        sortActionDescription="Ordenar por importe">
                                        Importe
                                    </th>
                                    <td class="right"
                                        mat-cell
                                        *matCellDef="let element"> {{element.total}} €</td>
                                </ng-container>

                                <!-- Tipo de pago -->
                                <ng-container matColumnDef="nombreTipoPago">
                                    <th mat-header-cell
                                        *matHeaderCellDef
                                        mat-sort-header
                                        sortActionDescription="Ordenar por tipo de pago">
                                        Tipo de pago
                                    </th>
                                    <td mat-cell
                                        *matCellDef="let element">
                                        <div class="pay-type">
                                            <mat-icon *ngIf="element.idCliente !== null"
                                                      [title]="element.cliente">account_circle</mat-icon>
                                            {{element.nombreTipoPago}}
                                        </div>
                                    </td>
                                </ng-container>

                                <tr mat-header-row
                                    *matHeaderRowDef="historicoVentasDisplayedColumns"></tr>
                                <tr class="clickable"
                                    mat-row
                                    [ngClass]="{'selected-row': row.id===historicoVentasSelected.id}"
                                    (click)="selectVenta(i)"
                                    *matRowDef="let row; columns: historicoVentasDisplayedColumns; let i = index;"></tr>
                            </table>
                        </div>
                        <div class="historico-data">
                            <div class="historico-data-select"
                                 *ngIf="historicoVentasSelected.id === null">Elige una venta de la lista.</div>
                            <div class="historico-detail"
                                 [ngClass]="{'show':historicoVentasSelected.id !== null}">
                                <div class="historico-detail-lineas"
                                     *ngIf="historicoVentasList.length > 0 && historicoVentasSelected !== null">
                                    <div class="historico-detail-linea"
                                         *ngFor="let linea of historicoVentasSelected.lineas">
                                        <div class="row">
                                            <div class="col">{{linea.localizador}}</div>
                                            <div class="col col-5"><strong>{{linea.articulo}}</strong></div>
                                        </div>
                                        <div class="row">
                                            <div class="col"><strong>{{linea.marca}}</strong></div>
                                        </div>
                                        <div class="row">
                                            <div class="col"><strong>Cant:</strong> {{linea.unidades}}</div>
                                            <div class="col">
                                                <strong>Desc:</strong>
                                                <span *ngIf="linea.descuento"> {{linea.descuento}} % </span>
                                                <span *ngIf="!linea.descuento"> - </span>
                                            </div>
                                            <div class="col col-2">
                                                <strong>Subt:</strong> {{linea.importe | fixedNumber}} €
                                                <span *ngIf="linea.total != linea.importe"
                                                      class="original-price">{{linea.total | fixedNumber}} €</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="historico-detail-options">
                                    <div class="historico-details-options-left">
                                        <mat-form-field class="mat-form-field-no-bottom">
                                            <mat-label>Elige cliente</mat-label>
                                            <mat-select [(ngModel)]="historicoVentasSelected.idCliente"
                                                        (ngModelChange)="changeCliente()">
                                                <mat-option [value]="null">Elige cliente</mat-option>
                                                <mat-option *ngFor="let cliente of cs.clientes"
                                                            [value]="cliente.id">
                                                    {{cliente.nombreApellidos}}
                                                </mat-option>
                                            </mat-select>
                                        </mat-form-field>
                                        <mat-form-field class="mat-form-field-no-bottom">
                                            <mat-label>Cambiar forma de pago</mat-label>
                                            <mat-select [(ngModel)]="historicoVentasSelected.idTipoPago"
                                                        (ngModelChange)="changeFormaPago()">
                                                <mat-option [value]="null">Elige forma de pago</mat-option>
                                                <mat-option *ngFor="let tipoPago of config.tiposPago"
                                                            [value]="tipoPago.id">
                                                    {{tipoPago.nombre}}
                                                </mat-option>
                                            </mat-select>
                                        </mat-form-field>
                                    </div>
                                    <div class="historico-details-options-right">
                                        <button mat-raised-button
                                                color="primary"
                                                [disabled]="!historicoVentasSelected.idCliente">
                                            <mat-icon>library_books</mat-icon>
                                            Factura
                                        </button>
                                        <button mat-raised-button
                                                color="primary">
                                            <mat-icon>card_giftcard</mat-icon>
                                            Ticket regalo
                                        </button>
                                        <button mat-raised-button
                                                color="primary">
                                            <mat-icon>print</mat-icon>
                                            Ticket
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </mat-tab>
                <mat-tab label="SALIDAS CAJA">salidas caja</mat-tab>
                <mat-tab label="CERRAR CAJA">cerrar caja</mat-tab>
            </mat-tab-group>
        </div>
    </div>
</div>