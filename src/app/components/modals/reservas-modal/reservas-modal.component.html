<div class="reservas">
    <div class="reservas-list">
        <div *ngIf="list.length>0">
            <table mat-table
                   [dataSource]="reservasDataSource"
                   matSort
                   class="mat-elevation-z2 ">

                <!-- Seleccionar -->
                <ng-container matColumnDef="select">
                    <th mat-header-cell
                        class="select"
                        *matHeaderCellDef>
                        <mat-checkbox (change)="$event ? masterToggle() : null"
                                      [checked]="selection.hasValue() && isAllSelected()"
                                      [indeterminate]="selection.hasValue() && !isAllSelected()">
                        </mat-checkbox>
                    </th>
                    <td mat-cell
                        class="select"
                        *matCellDef="let element">
                        <mat-checkbox (click)="$event.stopPropagation()"
                                      (change)="$event ? selection.toggle(element) : null"
                                      [checked]="selection.isSelected(element)">
                        </mat-checkbox>
                    </td>
                </ng-container>

                <!-- Fecha -->
                <ng-container matColumnDef="fecha">
                    <th mat-header-cell
                        *matHeaderCellDef
                        mat-sort-header
                        sortActionDescription="Ordenar por fecha">
                        Fecha
                    </th>
                    <td mat-cell
                        *matCellDef="let element"> {{element.fecha}} </td>
                </ng-container>

                <!-- Cliente -->
                <ng-container matColumnDef="cliente">
                    <th class="center"
                        mat-header-cell
                        *matHeaderCellDef
                        mat-sort-header
                        sortActionDescription="Ordenar por cliente">
                        Cliente
                    </th>
                    <td class="center"
                        mat-cell
                        *matCellDef="let element"> {{element.cliente.nombreApellidos}}</td>
                </ng-container>

                <!-- Importe -->
                <ng-container matColumnDef="importe">
                    <th class="right"
                        mat-header-cell
                        *matHeaderCellDef
                        mat-sort-header
                        sortActionDescription="Ordenar por importe">
                        Importe
                    </th>
                    <td mat-cell
                        class="right"
                        *matCellDef="let element">{{element.total | fixedNumber}} €</td>
                </ng-container>

                <tr mat-header-row
                    *matHeaderRowDef="reservasDisplayedColumns"></tr>
                <tr class="clickable"
                    mat-row
                    [ngClass]="{'selected-row': (reservaSelected !== null) && (row.id===reservaSelected.id)}"
                    (click)="selectReserva(i)"
                    *matRowDef="let row; columns: reservasDisplayedColumns; let i = index;"></tr>
            </table>
            <div class="reservas-load-selected">
                <button mat-raised-button
                        color="primary"
                        type="button"
                        [disabled]="selection.selected.length === 0"
                        (click)="cargarVentas()">Cargar ventas</button>
            </div>
        </div>
        <div class="reservas-no-data"
             *ngIf="list.length === 0">No hay reservas.</div>
    </div>
    <div class="reservas-detail">
        <div class="reserva-detail-no-data"
             *ngIf="reservaSelected === null">Elige una reserva de la lista.</div>
        <div class="reserva-detail"
             [ngClass]="{'show':reservaSelected !== null}">
            <div class="reserva-detail-lineas"
                 *ngIf="list.length > 0 && reservaSelected !== null">

                <table mat-table
                       [dataSource]="reservaSelectedDataSource"
                       matSort
                       class="mat-elevation-z2 ">

                    <!-- Localizador -->
                    <ng-container matColumnDef="localizador">
                        <th mat-header-cell
                            *matHeaderCellDef
                            mat-sort-header
                            sortActionDescription="Ordenar por localizador">
                            Localizador
                        </th>
                        <td mat-cell
                            *matCellDef="let element"> {{ element.idArticulo !== null ? element.localizador : '-' }} </td>
                        <td mat-footer-cell
                            *matFooterCellDef> <strong>Total</strong> </td>
                    </ng-container>

                    <!-- Marca -->
                    <ng-container matColumnDef="marca">
                        <th mat-header-cell
                            *matHeaderCellDef
                            mat-sort-header
                            sortActionDescription="Ordenar por marca">
                            Marca
                        </th>
                        <td mat-cell
                            *matCellDef="let element"> {{ element.idArticulo !== null ? element.marca : '-' }} </td>
                        <td mat-footer-cell
                            *matFooterCellDef></td>
                    </ng-container>

                    <!-- Descripción -->
                    <ng-container matColumnDef="articulo">
                        <th mat-header-cell
                            *matHeaderCellDef
                            mat-sort-header
                            sortActionDescription="Ordenar por descripcion">
                            Descripción
                        </th>
                        <td mat-cell
                            *matCellDef="let element"> {{element.nombreArticulo}} </td>
                        <td mat-footer-cell
                            *matFooterCellDef></td>
                    </ng-container>

                    <!-- Cantidad -->
                    <ng-container matColumnDef="unidades">
                        <th class="center"
                            mat-header-cell
                            *matHeaderCellDef
                            mat-sort-header
                            sortActionDescription="Ordenar por cantidad">
                            Cant.
                        </th>
                        <td class="center"
                            mat-cell
                            *matCellDef="let element"> {{element.unidades}} </td>
                        <td class="center"
                            mat-footer-cell
                            *matFooterCellDef> <strong>{{reservaSelected.totalUnidades}}</strong> </td>
                    </ng-container>

                    <!-- PVP -->
                    <ng-container matColumnDef="pvp">
                        <th class="center"
                            mat-header-cell
                            *matHeaderCellDef
                            mat-sort-header
                            sortActionDescription="Ordenar por PVP">
                            PVP
                        </th>
                        <td class="center"
                            mat-cell
                            *matCellDef="let element"> {{element.pvp | fixedNumber}} € </td>
                        <td class="center"
                            mat-footer-cell
                            *matFooterCellDef></td>
                    </ng-container>

                    <!-- Descuento -->
                    <ng-container matColumnDef="descuento">
                        <th class="center"
                            mat-header-cell
                            *matHeaderCellDef
                            mat-sort-header
                            sortActionDescription="Ordenar por descuento">
                            Desc.
                        </th>
                        <td class="center"
                            mat-cell
                            *matCellDef="let element">
                            <div *ngIf="element.importeDescuento">{{element.importeDescuento | fixedNumber}} €</div>
                            <div *ngIf="!element.importeDescuento && element.descuento !== 0">{{element.descuento}} %</div>
                            <div *ngIf="!element.importeDescuento && element.descuento === 0">-</div>
                        </td>
                        <td class="center"
                            mat-footer-cell
                            *matFooterCellDef>
                            <div *ngIf="reservaSelected.totalDescuento !== 0">
                                <strong>{{reservaSelected.totalDescuento | fixedNumber}} €</strong>
                            </div>
                        </td>
                    </ng-container>

                    <!-- Importe -->
                    <ng-container matColumnDef="importe">
                        <th class="center"
                            mat-header-cell
                            *matHeaderCellDef
                            mat-sort-header
                            sortActionDescription="Ordenar por importe">
                            Importe
                        </th>
                        <td class="center"
                            mat-cell
                            *matCellDef="let element">
                            {{element.importe | fixedNumber}} €
                            <div *ngIf="element.total != element.importe"
                                 class="original-price">{{element.total | fixedNumber}} €</div>
                        </td>
                        <td class="center"
                            mat-footer-cell
                            *matFooterCellDef> <strong>{{reservaSelected.total | fixedNumber}} €</strong> </td>
                    </ng-container>

                    <tr mat-header-row
                        *matHeaderRowDef="reservaSelectedDisplayedColumns"></tr>
                    <tr mat-row
                        *matRowDef="let row; columns: reservaSelectedDisplayedColumns;"></tr>
                    <tr mat-footer-row
                        *matFooterRowDef="reservaSelectedDisplayedColumns"></tr>
                </table>

            </div>
            <div class="reserva-detail-options">
                <button mat-raised-button
                        color="warn"
                        type="button"
                        (click)="deleteReserva()">Eliminar</button>
                <button mat-raised-button
                        color="primary"
                        type="button"
                        (click)="cargarVenta()">Cargar venta</button>
            </div>
        </div>
    </div>
</div>