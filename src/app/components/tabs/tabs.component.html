<div class="tab-container">
	<div class="tab-list">
		<div class="tab-item"
			 *ngFor="let tab of vs.list; let i = index"
			 [ngClass]="{'tab-selected': vs.selected==i}"
			 (click)="selectTab(i)"
			 [ngStyle]="{'background-color':tab.color, 'color':tab.textColor}">
			{{tab.name}}
			<mat-icon *ngIf="showClose"
					  class="tab-icon"
					  (click)="closeTab(i)">close</mat-icon>
		</div>
		<div class="new-tab"
			 (click)="newTab()">
			<mat-icon>add</mat-icon>
		</div>
		<div class="select-client"
			 (click)="selectClient()"
			 *ngIf="!vs.cliente">
			<mat-icon>person_add</mat-icon>
		</div>
		<div class="select-client"
			 (click)="removeClient()"
			 *ngIf="vs.cliente">
			<span>{{vs.cliente.nombreApellidos}}</span>
			<mat-icon>close</mat-icon>
		</div>
	</div>
</div>

<div class="modal-bg"
	 [ngClass]="{'show': mostrarElegirCliente}">
	<div class="modal-box">
		<div class="modal-header">
			<span>Seleccionar cliente</span>
			<a href="#"
			   (click)="cerrarElegirCliente($event)">
				<mat-icon>close</mat-icon>
			</a>
		</div>
		<div class="modal-body elegir-cliente">
			<mat-tab-group (selectedTabChange)="changeClienteTab($event)"
						   [selectedIndex]="elegirClienteSelectedTab"
						   (selectedIndexChange)="elegirClienteSelectedTab = $event"
						   #elegirClienteTabs>
				<mat-tab label="Buscar">
					<mat-form-field class="buscador">
						<input matInput
							   placeholder="Introduce el nombre, apellidos, teléfono o email del cliente a buscar"
							   [(ngModel)]="elegirClienteNombre"
							   (input)="searchStart()"
							   #elegirClienteBoxName>
					</mat-form-field>
					<div class="elegir-clientes-result"
						 *ngIf="searched">
						<table mat-table
							   [dataSource]="buscadorDataSource"
							   matSort
							   class="mat-elevation-z2 ">

							<!-- Nombre y apellidos -->
							<ng-container matColumnDef="nombreApellidos">
								<th mat-header-cell
									*matHeaderCellDef
									mat-sort-header
									sortActionDescription="Ordenar por nombre y apellidos">
									Nombre
								</th>
								<td mat-cell
									*matCellDef="let element"> {{element.nombreApellidos}} </td>
							</ng-container>

							<!-- Teléfono -->
							<ng-container matColumnDef="telefono">
								<th mat-header-cell
									*matHeaderCellDef
									mat-sort-header
									sortActionDescription="Ordenar por teléfono">
									Teléfono
								</th>
								<td mat-cell
									*matCellDef="let element"> {{element.telefono}} </td>
							</ng-container>

							<!-- Última venta -->
							<ng-container matColumnDef="ultimaVenta">
								<th class="center"
									mat-header-cell
									*matHeaderCellDef
									mat-sort-header
									sortActionDescription="Ordenar por última venta">
									Última venta
								</th>
								<td class="center"
									mat-cell
									*matCellDef="let element"> {{element.ultimaVenta ? element.ultimaVenta : '-'}} </td>
							</ng-container>

							<tr mat-header-row
								*matHeaderRowDef="buscadorDisplayedColumns"></tr>
							<tr mat-row
								class="clickable"
								(click)="selectCliente(row)"
								*matRowDef="let row; columns: buscadorDisplayedColumns;"></tr>
						</table>
						<div class="elegir-clientes-no-result"
							 *ngIf="searchResult.length===0">
							No se han encontrado resultados.
						</div>
					</div>
				</mat-tab>
				<mat-tab label="Nuevo cliente">
					<div class="cliente-nuevo-row">
						<mat-form-field class="cliente-nuevo-half">
							<mat-label>Nombre y apellidos</mat-label>
							<input matInput
								   placeholder="Nombre y apellidos"
								   [(ngModel)]="nuevoCliente.nombreApellidos"
								   #nuevoClienteBoxName>
						</mat-form-field>
						<mat-form-field class="cliente-nuevo-half">
							<mat-label>DNI / CIF</mat-label>
							<input matInput
								   placeholder="DNI / CIF"
								   [(ngModel)]="nuevoCliente.dniCif">
						</mat-form-field>
					</div>
					<div class="cliente-nuevo-row">
						<mat-form-field class="cliente-nuevo-half">
							<mat-label>Telefono</mat-label>
							<input matInput
								   placeholder="Telefono"
								   [(ngModel)]="nuevoCliente.telefono">
						</mat-form-field>
						<mat-form-field class="cliente-nuevo-half">
							<mat-label>Email</mat-label>
							<input matInput
								   placeholder="Email"
								   [(ngModel)]="nuevoCliente.email">
						</mat-form-field>
					</div>
					<div class="cliente-nuevo-row">
						<mat-form-field class="cliente-nuevo-full">
							<mat-label>Dirección</mat-label>
							<input matInput
								   placeholder="Dirección"
								   [(ngModel)]="nuevoCliente.direccion">
						</mat-form-field>
					</div>
					<div class="cliente-nuevo-row">
						<mat-form-field class="cliente-nuevo-third">
							<mat-label>Código Postal</mat-label>
							<input matInput
								   placeholder="Código Postal"
								   [(ngModel)]="nuevoCliente.codigoPostal">
						</mat-form-field>
						<mat-form-field class="cliente-nuevo-third">
							<mat-label>Población</mat-label>
							<input matInput
								   placeholder="Población"
								   [(ngModel)]="nuevoCliente.poblacion">
						</mat-form-field>
						<mat-form-field>
							<mat-label>Provincia</mat-label>
							<mat-select [(ngModel)]="nuevoCliente.provincia">
								<mat-option *ngFor="let provincia of config.provincias"
											[value]="provincia.id">
									{{provincia.name}}
								</mat-option>
							</mat-select>
						</mat-form-field>
					</div>
					<div class="cliente-nuevo-row">
						<mat-form-field class="cliente-nuevo-full">
							<mat-label>Observaciones</mat-label>
							<textarea matInput
									  placeholder="Observaciones"
									  [(ngModel)]="nuevoCliente.observaciones"
									  rows="5"></textarea>
						</mat-form-field>
					</div>
					<div class="cliente-nuevo-row">
						<mat-checkbox [(ngModel)]="nuevoCliente.factIgual">
							Mismos datos para la facturación
						</mat-checkbox>
					</div>
					<div class="cliente-nuevo-row"
						 *ngIf="!nuevoCliente.factIgual">
						<mat-form-field class="cliente-nuevo-half">
							<mat-label>Nombre y apellidos (Facturación)</mat-label>
							<input matInput
								   placeholder="Nombre y apellidos (Facturación)"
								   [(ngModel)]="nuevoCliente.factNombreApellidos">
						</mat-form-field>
						<mat-form-field class="cliente-nuevo-half">
							<mat-label>DNI / CIF (Facturación)</mat-label>
							<input matInput
								   placeholder="DNI / CIF (Facturación)"
								   [(ngModel)]="nuevoCliente.factDniCif">
						</mat-form-field>
					</div>
					<div class="cliente-nuevo-row"
						 *ngIf="!nuevoCliente.factIgual">
						<mat-form-field class="cliente-nuevo-half">
							<mat-label>Telefono (Facturación)</mat-label>
							<input matInput
								   placeholder="Telefono (Facturación)"
								   [(ngModel)]="nuevoCliente.factTelefono">
						</mat-form-field>
						<mat-form-field class="cliente-nuevo-half">
							<mat-label>Email (Facturación)</mat-label>
							<input matInput
								   placeholder="Email (Facturación)"
								   [(ngModel)]="nuevoCliente.factEmail">
						</mat-form-field>
					</div>
					<div class="cliente-nuevo-row"
						 *ngIf="!nuevoCliente.factIgual">
						<mat-form-field class="cliente-nuevo-full">
							<mat-label>Dirección (Facturación)</mat-label>
							<input matInput
								   placeholder="Dirección (Facturación)"
								   [(ngModel)]="nuevoCliente.factDireccion">
						</mat-form-field>
					</div>
					<div class="cliente-nuevo-row"
						 *ngIf="!nuevoCliente.factIgual">
						<mat-form-field class="cliente-nuevo-third">
							<mat-label>Código Postal (Facturación)</mat-label>
							<input matInput
								   placeholder="Código Postal (Facturación)"
								   [(ngModel)]="nuevoCliente.factCodigoPostal">
						</mat-form-field>
						<mat-form-field class="cliente-nuevo-third">
							<mat-label>Población (Facturación)</mat-label>
							<input matInput
								   placeholder="Población (Facturación)"
								   [(ngModel)]="nuevoCliente.factPoblacion">
						</mat-form-field>
						<mat-form-field>
							<mat-label>Provincia (Facturación)</mat-label>
							<mat-select [(ngModel)]="nuevoCliente.factProvincia">
								<mat-option *ngFor="let provincia of config.provincias"
											[value]="provincia.id">
									{{provincia.name}}
								</mat-option>
							</mat-select>
						</mat-form-field>
					</div>
					<div class="cliente-nuevo-save">
						<button mat-raised-button
								color="primary"
								(click)="saveNuevoCliente()"
								[disabled]="nuevoClienteSaving">
							<img *ngIf="nuevoClienteSaving"
								 src="/assets/loading.svg">
							Guardar y seleccionar
						</button>
					</div>
				</mat-tab>
			</mat-tab-group>
		</div>
	</div>
</div>