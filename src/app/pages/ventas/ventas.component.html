<otpv-header selectedOption="ventas"
			 #header></otpv-header>

<otpv-tabs [showClose]="true"
		   [ngClass]="{'hidden': vs.list.length===0}"
		   (closeTabEvent)="cerrarVenta($event)"
		   (newTabEvent)="newVenta()"
		   (changeTabEvent)="startFocus()"
		   (selectClientEvent)="selectClient($event)"></otpv-tabs>
<otpv-una-venta *ngFor="let venta of vs.list; let i = index"
				[ind]="i"
				[ngClass]="{'hidden':i!=vs.selected}"
				(deleteVentaLineaEvent)="deleteVentaLinea($event)"
				(endVentaEvent)="endVenta($event)"
				(openCajaEvent)="openCaja($event)"
				#ventas></otpv-una-venta>

<div class="modal-bg"
	 [ngClass]="{'show': showFinalizarVenta}">
	<div class="modal-box">
		<div class="modal-header">
			<span>Finalizar venta</span>
		</div>
		<div class="modal-body finalizar-venta">
			<div class="col-left">
				<div class="col-line">
					<mat-form-field subscriptSizing="dynamic">
						<mat-label>Efectivo</mat-label>
						<input matInput
							   placeholder="Efectivo"
							   [(ngModel)]="vs.fin.efectivo"
							   [disabled]="vs.fin.idTipoPago !== null && !vs.fin.pagoMixto"
							   (focus)="$event.target.select()"
							   (input)="updateCambio()"
							   #efectivoValue>
					</mat-form-field>
					€
					<mat-form-field subscriptSizing="dynamic">
						<mat-label>Cambio</mat-label>
						<input matInput
							   placeholder="Cambio"
							   [(ngModel)]="vs.fin.cambio"
							   [disabled]="vs.fin.idTipoPago !== null && !vs.fin.pagoMixto"
							   readonly>
					</mat-form-field>
					€
				</div>
				<div class="tipos-pago">
					<div class="tipo-pago"
						 *ngFor="let tipo of config.tiposPago"
						 [ngClass]="{'tipo-pago-selected': vs.fin.idTipoPago===tipo.id}"
						 (click)="selectTipoPago(tipo.id)">
						<img [src]="tipo.foto">
						{{tipo.nombre}}
					</div>
				</div>
				<div class="col-line-check">
					<mat-checkbox [(ngModel)]="vs.fin.pagoMixto"
								  (change)="changePagoMixto($event)">Pago mixto</mat-checkbox>
					<mat-form-field subscriptSizing="dynamic">
						<mat-label>Importe tarjeta</mat-label>
						<input matInput
							   placeholder="Importe tarjeta"
							   [(ngModel)]="vs.fin.tarjeta"
							   [disabled]="!vs.fin.pagoMixto"
							   (focus)="$event.target.select()"
							   (input)="updateEfectivoMixto()"
							   #tarjetaValue>
					</mat-form-field>
				</div>
				<div class="col-line-check">
					<mat-checkbox [(ngModel)]="vs.fin.factura"
								  (change)="changeFactura($event)">Factura</mat-checkbox>
					<mat-form-field subscriptSizing="dynamic">
						<mat-select [(ngModel)]="vs.fin.idCliente"
									[disabled]="!vs.fin.factura"
									#clientesValue>
							<mat-option *ngFor="let cliente of clientes"
										[value]="cliente.id">
								{{cliente.nombreApellidos}}
							</mat-option>
						</mat-select>
					</mat-form-field>
				</div>
				<div class="total mat-elevation-z4">
					<div class="total-title">TOTAL</div>
					<div class="total-importe">{{vs.fin.total}} €</div>
				</div>
				<div class="col-line">
					<button mat-raised-button
							color="warn"
							(click)="cerrarFinalizarVenta()"
							[disabled]="saving">Cancelar</button>
					<button mat-raised-button
							color="primary"
							(click)="finalizarVenta()"
							[disabled]="saving">
						<img src="/assets/loading.svg"
							 *ngIf="saving">
						Finalizar
					</button>
				</div>
			</div>
			<div class="col-right">
				<table mat-table
					   [dataSource]="ventasFinDataSource"
					   matSort
					   class="mat-elevation-z2 ">

					<!-- Localizador -->
					<ng-container matColumnDef="localizador">
						<th mat-header-cell
							*matHeaderCellDef
							mat-sort-header
							sortActionDescription="Ordenar por localizador">
							Loc.
						</th>
						<td mat-cell
							*matCellDef="let element"> {{element.localizador}} </td>
					</ng-container>

					<!-- Descripción -->
					<ng-container matColumnDef="descripcion">
						<th mat-header-cell
							*matHeaderCellDef
							mat-sort-header
							sortActionDescription="Ordenar por descripcion">
							Descripción
						</th>
						<td mat-cell
							*matCellDef="let element"> {{element.descripcion}} </td>
					</ng-container>

					<!-- Cantidad -->
					<ng-container matColumnDef="cantidad">
						<th class="center"
							mat-header-cell
							*matHeaderCellDef
							mat-sort-header
							sortActionDescription="Ordenar por cantidad">
							Cant.
						</th>
						<td class="center"
							mat-cell
							*matCellDef="let element"> {{element.cantidad}} </td>
					</ng-container>

					<!-- Descuento -->
					<ng-container matColumnDef="descuento">
						<th class="center"
							mat-header-cell
							*matHeaderCellDef
							mat-sort-header
							sortActionDescription="Ordenar por descuento">
							Desc.
						</th>
						<td class="center"
							mat-cell
							*matCellDef="let element">
							<span *ngIf="element.descuentoManual">{{element.descuento}} €</span>
							<span *ngIf="!element.descuentoManual && element.descuento !== 0">{{element.descuento}} %</span>
							<span *ngIf="!element.descuentoManual && element.descuento === 0">-</span>
						</td>
					</ng-container>

					<!-- Importe -->
					<ng-container matColumnDef="total">
						<th class="center"
							mat-header-cell
							*matHeaderCellDef
							mat-sort-header
							sortActionDescription="Ordenar por importe">
							Importe
						</th>
						<td class="center"
							mat-cell
							*matCellDef="let element"> {{element.total | fixedNumber}} € </td>
					</ng-container>

					<tr mat-header-row
						*matHeaderRowDef="ventasFinDisplayedColumns"></tr>
					<tr mat-row
						*matRowDef="let row; columns: ventasFinDisplayedColumns;"></tr>
				</table>
			</div>
		</div>
	</div>
</div>